sudo: required

language: node_js

node_js:
- '5'

branches:
  only: develop #limit push building to develop branch to avoid double building on PRs

services:
- docker

before_install:
- sudo apt-get update
- sudo apt-get -y remove docker-engine
- sudo rm /etc/default/docker
- sudo apt-get -y install docker-engine #upgrade Docker for --build-arg support
- sudo service docker start
- docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"

before_script:
- npm run postpublish

script:
- npm run test-coverage #run full tests and coverage

deploy:
  provider: npm
  email: toddsurfs@icloud.com
  api_key:
    secure: d6NkFa4UDdMkJpIN+xkUazJsqERu4RrODQ7/AVzal/KJAWvy0ihXIx1HWOIPCqwYwril+62WwGjqbUAnRAo1FHpip+gUt222A08mOLsEnOW+rbpKZl7A6HErXD1tYxW9tHzPfZ2daSWSo1EDL5c0N0iB3gmnFreBhBE7RDN63nMkvikCGj7UmQUAeDpRKyXuO2AXEUZacPPC68rmXX41WXuXNBSPCdBUF3AxAWRlwBlTnQ8yVntFfD2DL8emqUvdflAbhpZOUmD7003t/klVGhbrfWU49O6kGKOIXMy7Of8+bh+OQKKTXvWqMHX8BhKPMhfXPujfyAhHBNGl1e3ZiNP8zuWA1hEiGwkSK41I6yHA7Hc0ZXDN2nn/kPSp9BcDHvIpwQiooEfi46EW99RRp2Fw766AItDiI8CNu8nX1Hv4J9L+EDpSu/8ISu+fVH6CxHcCDJcRXfJYu0Rzru+GlKjDaPot3NqUer68yIVmsrm0IOBfzcFuJBYuzf3G84/bDTYAkZhZBs1nBJDJtgSxVJxFo49HcWlsWn9yfOJtE4MRno1uY/Gk5Q5HMFcrLqANRZ/xxO/O6hmQzYQEl22dQv/0SnE6eo+di1y3hwk+uzqFVOnJJnILD6tE/JF398AtGnF346vTRxIUpMObzVG7JyEk6RP/6+ZBmKDaJfUACFo=
  on:
    tags: true #only deploy tagged commits
    repo: TrueCar/gluestick #only deploy from official repo
    branch: develop #only deploy develop branch
    condition: $TRAVIS_TAG =~ ^v[0-9]+\.[0-9]+\.[0-9]$ #limit tags to be v0.0.0 format

#notifications:
#  slack:
#    on_success: change
#    on_failure: change
#    rooms:
#      secure: Cr01Gw/zlUGA7KuPpE2YZwm2SIuWJ8F5qhqsT7UofuSgMPTbyQtIlpAuoo1/7fNYt5OnkmorlKWa3qpMFndxGD9bd9rzWBq2sta8HuToYCxMSDTGHFG1DFMybDUBCZ3rjxxSgi6j39JmYoH/aqgZJmD/NkkNuzzmB+7qGRMuS/zMI4dNSF8gfoop0Uj5/mEZqgcDJRrXFQntmK2z9rVvS7dkM9Dd2vA0EYMy6vaxnW72dy2t6e/qR/DlNoKZ0V6j0LAwNYd8cPlSUH/W+fpOfR9T5lo+Bzd+VBNoO/srkTxu6vRzzazjUnJOzertl2e/oRmBJnr7X/F4z5Qy1U80qT4eqkGythuN0wZHB6BCxg2RC7pvkyOFFSDxSDT/lqqdzlmuFCArB4Nsz7LDpu88cSpwF2lNu8f9t8lSIpelwH0kedvVIuKxx5i6z1y3nZL8bexze3JnkCQVMPsJ7R1aHeJ+eQS5MNNgaPAsNU24w1KoeeCHrXI1Q/Bnte3A0w1C6SY8OiX92IO9X9kaqd9wwTeZSmXH3iQc8TBIpM++d4wgDaximput+3pdWjNk/vGlZvntIzlexpoAtXWUVH0ArjOxIoXuDG2oJG0sZeHiJbKLllCWrhOtQrgmZsQjOozEVgl0SrECtUZ78nZD5B7jFkar/yG1aO28+jxoiDdoqgU=
