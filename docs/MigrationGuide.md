# 1.x Migration Guide

This migration guide is splited into 3 parts:
- Project overview
- Apps and shared code
- Configuration

## Project overview

Before diving deeper, it's essential to familiarize yourself with new project structure.

Here is project `src` directory tree generated by `gluestick new` command:
```
src
├── apps
│   └── main
│       ├── Index.js
│       ├── actions
│       ├── components
│       │   ├── Home.css
│       │   ├── Home.js
│       │   ├── MasterLayout.js
│       │   └── __tests__
│       │       ├── Home.test.js
│       │       └── MasterLayout.test.js
│       ├── containers
│       │   ├── HomeApp.js
│       │   ├── NoMatchApp.js
│       │   └── __tests__
│       │       ├── HomeApp.test.js
│       │       └── NoMatchApp.test.js
│       ├── reducers
│       │   └── index.js
│       └── routes.js
├── config
│   ├── .Dockerfile
│   ├── application.js
│   ├── application.server.js
│   ├── caching.server.js
│   ├── init.browser.js
│   ├── redux-middleware.js
│   └── webpack-additions.js
├── entries.json
├── gluestick.hooks.js
├── gluestick.plugins.js
├── shared
│   ├── actions
│   ├── components
│   ├── containers
│   └── reducers
│       └── index.js
└── webpack.hooks.js
```

> Apart from `src` directory, `new` command will also create other files in root folder, outside of `src`, like `.eslintrc`, `.flowconfig`, `package.json` etc. However they do not need any special tretment.

`src` directory consits of 3 essential parts:
- `apps` - contains apps
- `config` - project-wide configrations
- `shared` - shared actions, components, containers etc between apps

# Apps and shared code

As described in previous section all apps resides inside `src/apps` directory. Each app has it's own folder, each one must have at least root component (by default it's `Index.js`), routes (`routes.js`) and reducers object (`reducers/index.js`).

As you can see, its similar to GlueStick 0.x project structure, so you will only need to update paths in `import` statements and reducers index.

For example, if previously there was:
```
import SomeComponen from 'components/SomeComponent';
```
now you must specify *who onws this component* - whether it's `shared` or inside some app:
```
import SomeComponen from 'shared/components/SomeComponen';
// or
import SomeComponen from 'myApp/components/SomeComponen';
```
Same goes for `actions`, `containers` etc.

Here is the list of all available aliases:
- `<appName>` - path to `appName` app
- `root` - path to project root directory
- `src` - path to project source directory
- `assets` - path to assets directory (`<root>/assets`)
- `shared` - path to shared code (`<src>/shared`)
- `config` - path to configurations (`<src>/config`)
- `apps` - path to apps (`<src>/apps`)
- `compiled` - path to `node_modules` module which needs to be parsed by webpack loaders (by default all modules from `node_modules` will be marked as external in server bundle, which means they won't be parsed by loaders, so in case you need module to be transpiled or if it's css/scss file you need to prefix it with this alias eg: `import 'compiled/normalize.css'`)

Previusly `reducers/index.js` file was re-exporting reducers:
```
export { default as myReducer } from './myReducer';
```
but now it needs to export single object with `key`: `reducer` pairs:
```
import myReducer from './myReducer';

export default {
  myReducer,
}
```

## Configuration
The most important file is `entries.json`, since it defines every entrypoint for webpack:
```json
{
  "/": {
    "component": "src/apps/main/Index.js",
    "routes": "src/apps/main/routes.js",
    "reducers": "src/apps/main/reducers"
  }
}
```

> App is also refered to as `entrypoint`, since every app will later become single webpack entrypoint.

`entries.json` must be an object with `key`: `object` pairs. Each entry defines single entrypoint for webpack.

- `key` (in example it's `"/"`) is a url-like path to where entrypoint is mounted
- `component` is a path to root app component
- `routes` is a path to app routes
- `reducers` is a path to reducers object (reducers index)`

> __IMPORTNANT__: entrypoint `key` must be the same as `path` prop in top-level `<Route>` component in `routes` file.

If case, entrypoint `key` is too verbose you can specify alternative alias using `name` filed:
```
{
  "/very-long-entry-key": {
    "name": "shortName",
    ...
  }
}
```

More about `entries.json` can be found [here](./Apps.md)

There are also other files:
- [`gluestick.hooks.js`](./CachingAndHooks.md#hooks) - `init.server.js` is no longer supported and can code should be moved to `preInitServer` hook
- [`gluestick.plugins.js`](./Plugins.md) - specify plugins to use
- [`webpack.hooks.js`](./CachingAndHooks.md#webpack-hooks) - overwrite webpack config
- [`caching.server.js`](./CachingAndHooks.md#caching) 

To use `cofnig/webpack-additions.js` and/or `config/application.server.js` you must need `gluestick-config-legacy` plugin installed and enabled, however recommended approach is to use `webpack.hooks.js`, since at some point in the future `gluestick-config-legacy` will be deprecated.

`config/redux-middleware.js` and `config/application.js` works as before.
